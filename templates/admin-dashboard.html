<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard | Placement Cell</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { font-family: Arial, sans-serif; background:#f4f6f9; padding:20px; color:#333; }
h1 { text-align:center; color:#007bff; margin-bottom:20px; }
.btn-danger { display:block; margin:0 auto 20px; width:120px; font-weight:bold; }
.chart-container { width:45%; display:inline-block; margin:20px 2%; vertical-align:top; background:#fff; padding:15px; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
table { width:100%; border-collapse:collapse; background:#fff; border-radius:10px; overflow:hidden; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
th, td { padding:12px 15px; text-align:center; }
th { background:#007bff; color:#fff; }
tbody tr:nth-child(even){background:#f2f2f2;}
tbody tr:hover{background:#e0f0ff;}
footer{margin-top:30px;text-align:center;color:#666;font-size:14px;}
@media(max-width:768px){.chart-container{width:100%; margin:20px 0;} th,td{font-size:12px; padding:8px;}}
</style>
</head>
<body>

<h1>üë©‚Äçüíº Admin Dashboard</h1>
<a href="/logout" class="btn btn-danger mb-3">Logout</a>

{% if students %}
<div id="chart-data"
    data-names="{{ students | map(attribute='name') | join(',') }}"
    data-cgpas="{{ students | map(attribute='cgpa') | join(',') }}"
    data-placed="{{ students | map(attribute='placed') | join(',') }}"
    data-salaries="{{ students | map(attribute='expected_salary') | join(',') }}"
    data-branches="{{ students | map(attribute='branch') | join(',') }}"
    data-years="{{ students | map(attribute='year') | join(',') }}">
</div>

<!-- Charts -->
<div class="chart-container"><canvas id="placementByYear"></canvas></div>
<div class="chart-container"><canvas id="placementByBranch"></canvas></div>
<div class="chart-container"><canvas id="packageDistribution"></canvas></div>
<div class="chart-container"><canvas id="futurePrediction"></canvas></div>

<!-- Student Table -->
<table class="table table-bordered table-striped mt-4">
<thead class="table-dark">
<tr>
<th>#</th>
<th>College Name</th>
<th>Name</th>
<th>SSC %</th>
<th>HSC %</th>
<th>Prev Sem Result</th>
<th>Academic Performance</th>
<th>Extra Curricular</th>
<th>Communication</th>
<th>Branch</th>
<th>Year</th>
<th>Skills</th>
<th>CGPA</th>
<th>Expected Salary</th>
<th>Projects</th>
<th>Internship</th>
<th>Certifications</th>
<th>Preferred Company</th>
<th>Resume</th>
</tr>
</thead>
<tbody>
{% for s in students %}
<tr>
<td>{{ loop.index }}</td>
<td>{{ s['college_name'] }}</td>
<td>{{ s['name'] }}</td>
<td>{{ s['ssc_percentage'] }}</td>
<td>{{ s['hsc_percentage'] }}</td>
<td>{{ s['prev_sem_result'] }}</td>
<td>{{ s['academic_performance'] }}</td>
<td>{{ s['extra_curricular_activity'] }}</td>
<td>{{ s['communication'] }}</td>
<td>{{ s['branch'] }}</td>
<td>{{ s['year'] }}</td>
<td>{{ s['skills'] }}</td>
<td>{{ s['cgpa'] }}</td>
<td>{{ s['expected_salary'] }}</td>
<td>{{ s['projects'] }}</td>
<td>{{ s['internship'] }}</td>
<td>{{ s['certifications'] }}</td>
<td>{{ s['company'] }}</td>
<td>{% if s['resume'] %}<a href="/resumes/{{ s['resume'] }}" target="_blank">View</a>{% else %}N/A{% endif %}</td>
</tr>
{% endfor %}
</tbody>
</table>
{% else %}
<p>No student submissions yet.</p>
{% endif %}

<footer>
<p>¬© 2025 Placement Cell | Arvind Gavali College of Engineering, Satara</p>
</footer>

<script>
const chartDataDiv = document.getElementById('chart-data');
if(chartDataDiv){
    const names = chartDataDiv.dataset.names.split(',');
    const cgpas = chartDataDiv.dataset.cgpas.split(',').map(Number);
    const placed = chartDataDiv.dataset.placed.split(',').map(Number);
    const salaries = chartDataDiv.dataset.salaries.split(',').map(Number);
    const branches = chartDataDiv.dataset.branches.split(',');
    const years = chartDataDiv.dataset.years.split(',');

    // Chart 1: Placement by Year
    const placementByYear = {};
    years.forEach((y,i)=>{ const p = placed[i]; placementByYear[y]=(placementByYear[y]||0)+p; });
    new Chart(document.getElementById('placementByYear'),{
        type:'bar',
        data:{labels:Object.keys(placementByYear), datasets:[{label:'Students Placed', data:Object.values(placementByYear), backgroundColor:'rgba(75,192,192,0.6)'}]}
    });

    // Chart 2: Placement by Branch
    const placementByBranch = {};
    branches.forEach((b,i)=>{ const p = placed[i]; placementByBranch[b]=(placementByBranch[b]||0)+p; });
    new Chart(document.getElementById('placementByBranch'),{
        type:'bar',
        data:{labels:Object.keys(placementByBranch), datasets:[{label:'Placed Students by Branch', data:Object.values(placementByBranch), backgroundColor:'rgba(153,102,255,0.6)'}]}
    });

    // Chart 3: Package Distribution
    const packageDist = {};
    salaries.forEach(s=>{ const r = s<5?'<5LPA':s<8?'5-8LPA':s<10?'8-10LPA':'10+LPA'; packageDist[r]=(packageDist[r]||0)+1; });
    new Chart(document.getElementById('packageDistribution'),{
        type:'pie',
        data:{labels:Object.keys(packageDist), datasets:[{data:Object.values(packageDist), backgroundColor:['#FF6384','#36A2EB','#FFCE56','#4BC0C0','#9966FF','#FF9F40','#C9CBCF']}]}
    });

    // Chart 4: Future Placement Prediction
    const futurePrediction = {};
    Object.keys(placementByYear).forEach(y=>{ futurePrediction[parseInt(y)+1]=Math.round(placementByYear[y]*1.1); });
    new Chart(document.getElementById('futurePrediction'),{
        type:'bar',
        data:{labels:Object.keys(futurePrediction), datasets:[{label:'Predicted Next Year Placement', data:Object.values(futurePrediction), backgroundColor:'rgba(255,159,64,0.6)'}]}
    });
}
</script>

</body>
</html>
